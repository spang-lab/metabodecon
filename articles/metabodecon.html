<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="metabodecon">
<title>metabodecon • metabodecon</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="metabodecon">
<meta property="og:description" content="metabodecon">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">metabodecon</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/metabodecon.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/MetaboDecon1D.html">MetaboDecon1D</a>
    <a class="dropdown-item" href="../articles/FAQ.html">FAQ</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>metabodecon</h1>
            
      
      
      <div class="d-none name"><code>metabodecon.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction-to-metabodecon">Introduction to metabodecon<a class="anchor" aria-label="anchor" href="#introduction-to-metabodecon"></a>
</h2>
<p>The goal of metabodecon is to make deconvolution and alignment of 1D
NMR spectra as easy as possible. The deconvolution part uses the
codebase from <a href="https://www.doi.org/10.3390/metabo11070452" class="external-link">MetaboDecon1D</a>. The
alignment of the deconvoluted spectra is done using functions from the
<a href="https://CRAN.R-project.org/package=speaq" class="external-link">speaq</a> package (<a href="#beirnaert-et-al-2018">Beirnaert et al., 2018</a>) that have been
adapted for metabodecon.</p>
<div class="section level3">
<h3 id="download-the-example-data">Download the example data<a class="anchor" aria-label="anchor" href="#download-the-example-data"></a>
</h3>
<p>The <a href="https://github.com/spang-lab/metabodecon" class="external-link">metabodecon
repository</a> contains two example datasets: <a href="https://github.com/spang-lab/metabodecon/tree/main/misc/datasets/blood" class="external-link">blood</a><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;previously called &lt;em&gt;test&lt;/em&gt;&lt;/p&gt;"><sup>1</sup></a> and <a href="https://github.com/spang-lab/metabodecon/tree/main/misc/datasets/urine" class="external-link">urine</a>.
The <em>blood</em> dataset contains 16 1D CPMG NMR spectra of blood
plasma in Bruker format. The <em>urine</em> dataset contains two 1D
NOESY NMR spectra of urine. These spectra are available in both Bruker
and jcamp-dx format. Due to the size constraints for R packages, these
datasets are not included by default when the package is installed, but
must be explicitly downloaded afterwards via command
<code><a href="../reference/download_example_datasets.html">download_example_datasets()</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://spang-lab.github.io/metabodecon/" class="external-link">metabodecon</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/download_example_datasets.html">download_example_datasets</a></span><span class="op">(</span>persistent <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Set persistent to TRUE to keep the data after the R session ends</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="use-metabodecon-to-convert-a-spectrum-into-lorentz-curves">Use metabodecon to convert a spectrum into Lorentz curves<a class="anchor" aria-label="anchor" href="#use-metabodecon-to-convert-a-spectrum-into-lorentz-curves"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spectrum_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_lorentz_curves.html">generate_lorentz_curves</a></span><span class="op">(</span></span>
<span>  data_path <span class="op">=</span> <span class="fu"><a href="../reference/datadir.html">datadir</a></span><span class="op">(</span><span class="st">"example_datasets/bruker/blood"</span><span class="op">)</span>,</span>
<span>  file_format <span class="op">=</span> <span class="st">"bruker"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After calling function <code><a href="../reference/generate_lorentz_curves.html">generate_lorentz_curves()</a></code>, R will
request some interactive input from the user. Note that the data path
i.e. the folder where the samples with their spectra are stored is given
by the <code>data_path</code> argument. All samples in this folder will
be automatically analyzed. Therefore, you do not have to specify the
individual sample names. But you have to specify which spectrum and
which processing of each sample should be used. The answers you should
give for the provided examples are written in bold:</p>
<ul>
<li>What is the name of the subfolder of your filepath? The different
spectra of a sample are specified by numbers, here you have to specify
which spectrum should be used (e.g. 10 for
C:/Users/Username/Desktop/spectra_folder/spectrum_name/10)
<strong>10</strong>
</li>
<li>What is the name of the subsubsubfolder of your filepath? Each
spectrum can be processed with different settings, each of these
computations is stored under a different number (e.g. 10 for
C:/Users/Username/Desktop/spectra_folder/spectrum_name/10/pdata/10):
<strong>10</strong>
</li>
<li>In case that more than one spectrum should be analyzed, you will be
asked: Do you want to use the same parameters (signal_free_region,
range_water_signal_ppm) for all spectra? (y/n) <strong>y</strong>
</li>
<li>“Test_01” “Test_02” “Test_03” “Test_04” “Test_05” … “Test_16”.
Choose number of file which is used to adjust all parameters: (e.g. 1)
<strong>1</strong>
</li>
</ul>
<p>After providing the required input, metabodecon will show you some
plots and ask some more questions regarding the plots. Again, the
answers are shown in bold.</p>
<ul>
<li>Signal free region borders correct selected? (Area left and right of
the green lines) (y/n) <strong>y</strong>
</li>
<li>Water artefact fully inside red vertical lines? (y/n)
<strong>y</strong>
</li>
</ul>
<p>Now the actual deconvolution will start. The deconvolution of one
single spectra usually takes approx. 1-10 minutes.</p>
</div>
<div class="section level3">
<h3 id="look-up-global-max-and-minimum-ppm-values">Look up global max and minimum ppm values<a class="anchor" aria-label="anchor" href="#look-up-global-max-and-minimum-ppm-values"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ppm_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_ppm_range.html">get_ppm_range</a></span><span class="op">(</span></span>
<span>  spectrum_data <span class="op">=</span> <span class="va">spectrum_data</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generate-matrix-of-features-based-on-spectrum-data">Generate matrix of features based on spectrum data<a class="anchor" aria-label="anchor" href="#generate-matrix-of-features-based-on-spectrum-data"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_feat_mat.html">gen_feat_mat</a></span><span class="op">(</span></span>
<span>  data_path <span class="op">=</span> <span class="va">data_path</span>,</span>
<span>  ppm_range <span class="op">=</span> <span class="va">ppm_range</span>,</span>
<span>  si_size_real_spectrum <span class="op">=</span> <span class="fl">131072</span>, <span class="co"># 1)</span></span>
<span>  scale_factor_x <span class="op">=</span> <span class="fl">1000</span> <span class="co"># 2)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1) Specify how many points were used to process the real spectrum? Often</span></span>
<span><span class="co"># called "si" inside NMR software (TopSpin).</span></span>
<span><span class="co"># 2) A factor which is used to avoid rounding errors due to numbers becoming</span></span>
<span><span class="co"># too small for R to handle e.g., 1000.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="start-alignment-by-using-speaq-package">Start alignment by using speaq package<a class="anchor" aria-label="anchor" href="#start-alignment-by-using-speaq-package"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">after_speaq_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/speaq_align.html">speaq_align</a></span><span class="op">(</span></span>
<span>  feat <span class="op">=</span> <span class="va">feat</span>,</span>
<span>  maxShift <span class="op">=</span> <span class="fl">50</span> <span class="co"># 1)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1) Maximum number of points along the "ppm-axis" a value can be moved by the</span></span>
<span><span class="co"># speaq package. A value of 50 may be used as start value for plasma spectra.</span></span>
<span><span class="co"># However, depending on your spectra and the used digital resolution this value</span></span>
<span><span class="co"># may be be adapted.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="further-optimize-alignment-by-calling-combine_peaks">Further optimize alignment by calling
<code>combine_peaks</code><a class="anchor" aria-label="anchor" href="#further-optimize-alignment-by-calling-combine_peaks"></a>
</h3>
<p>Even, after alignment by speaq data of some signals are spread over
adjacent columns. Combination of this data is the purpose of the
following routine.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>aligned_res <span class="ot">&lt;-</span> <span class="fu">combine_peaks</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">shifted_mat =</span> after_speaq_mat,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">range =</span> <span class="dv">5</span>, <span class="co"># 1) number of adjacent columns to be used for improving alignment</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower_bound =</span> <span class="dv">1</span> <span class="dv">2</span>) <span class="co"># amount of columns that need to be skipped</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  spectrum_data <span class="ot">=</span> spectrum_data,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  data_path <span class="ot">=</span> data_path</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="er">)</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Number of columns of which data may be combined in one column</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) When results from speaq are used first column should be skipped</span></span></code></pre></div>
<p>The returned results after step 5 contain two matrices
<code>aligned_res$long</code> and <code>aligned_res$short</code> where
in the short version all columns containing only zeros have been removed
Furthermore, results will be written into two .csv files in your
<code>data_path</code> directory “aligned_res_short.csv” and
“aligned_res_long.csv”.</p>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div class="section level4">
<h4 id="beirnaert-et-al-2018">Beirnaert et al 2018<a class="anchor" aria-label="anchor" href="#beirnaert-et-al-2018"></a>
</h4>
<p>Beirnaert C, Meysman P, Vu TN, Hermans N, Apers S, Pieters L, et
al. (2018) speaq 2.0: A complete workflow for high-throughput 1D NMR
spectra processing and quantification. PLoS Comput Biol 14(3): e1006018.
<a href="https://www.doi.org/" class="external-link uri">https://www.doi.org/</a>
10.1371/journal.pcbi.1006018</p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Wolfram Gronwald, Martina Haeckl, Tobias Schmidt.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
