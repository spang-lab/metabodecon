<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Get Started • metabodecon</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get Started">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">metabodecon</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Get_Started.html">Get Started</a></li>
    <li><a class="dropdown-item" href="../articles/FAQ.html">FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/MetaboDecon1D.html">MetaboDecon1D</a></li>
    <li><a class="dropdown-item" href="../articles/Datasets.html">Datasets</a></li>
    <li><a class="dropdown-item" href="../articles/Contributing.html">Contributing</a></li>
    <li><a class="dropdown-item" href="../articles/Compatibility.html">Compatibility</a></li>
    <li><a class="dropdown-item" href="../articles/Classes.html">Metabodecon Classes</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/spang-lab/metabodecon/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Get Started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/spang-lab/metabodecon/blob/main/vignettes/Get_Started.Rmd" class="external-link"><code>vignettes/Get_Started.Rmd</code></a></small>
      <div class="d-none name"><code>Get_Started.Rmd</code></div>
    </div>

    
    
<style>
figure{
    border: 1px solid #dee2e6; border-radius: .375rem; padding: 0;
}
figcaption{
    text-align: center; font-style: italic; border-top: 1px solid #dee2e6;
    padding: 0.75rem; background-color: #ffffff;
}
.sourceCode.txt{
    background-color: #f1f3f5;
}
</style>
<p>This article shows how Metabodecon can be used for deconvoluting and
aligning one-dimensional NMR spectra using the pre-installed <a href="https://spang-lab.github.io/metabodecon/articles/Datasets.html#sim">Sim</a>
dataset as an example. The Sim dataset includes 16 simulated spectra,
each with 2048 data points ranging from ≈ 3.6 to 3.3 ppm. These
simulated spectra closely mimic the resolution and signal strength of
real NMR experiments on blood plasma from 16 individuals. The Sim
dataset is used instead of the Blood dataset because it is smaller,
faster to process, and comes pre-installed with the package. For more
information on the Sim and Blood datasets, see <a href="https://spang-lab.github.io/metabodecon/articles/Datasets.html">Datasets</a>.</p>
<div class="section level2">
<h2 id="deconvolute-spectra">Deconvolute spectra<a class="anchor" aria-label="anchor" href="#deconvolute-spectra"></a>
</h2>
<p>To find the path to the Sim dataset, you can use the
<code><a href="../reference/metabodecon_file.html">metabodecon_file()</a></code> function, which returns the path to any
file or directory within the package directory. To deconvolute the
spectra within the Sim dataset you can use
<code><a href="../reference/deconvolute.html">generate_lorentz_curves()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_dir</span> <span class="op">&lt;-</span> <span class="fu">metabodecon</span><span class="fu">::</span><span class="fu"><a href="../reference/metabodecon_file.html">metabodecon_file</a></span><span class="op">(</span><span class="st">"bruker/sim"</span><span class="op">)</span></span>
<span><span class="va">deconvoluted_spectra</span> <span class="op">&lt;-</span> <span class="fu">metabodecon</span><span class="fu">::</span><span class="fu"><a href="../reference/deconvolute.html">generate_lorentz_curves</a></span><span class="op">(</span></span>
<span>    data_path <span class="op">=</span> <span class="va">sim_dir</span>, <span class="co"># Path to directory containing spectra</span></span>
<span>    sfr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3.35</span>, <span class="fl">3.55</span><span class="op">)</span>, <span class="co"># Borders of signal free region (SFR) in ppm</span></span>
<span>    wshw <span class="op">=</span> <span class="fl">0</span>,            <span class="co"># Half width of water signal (WS) in ppm</span></span>
<span>    smopts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span>,    <span class="co"># Configure smoothing parameters</span></span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span>      <span class="co"># Suppress status messages</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After calling <code><a href="../reference/deconvolute.html">generate_lorentz_curves()</a></code>, the function
will ask you to answer the following questions to determine the optimal
deconvolution parameters:</p>
<ol style="list-style-type: decimal">
<li>Use same parameters for all spectra? (y/n)</li>
<li>Number of spectrum for adjusting parameters? (1: sim_01, 2: sim_02,
…)</li>
<li>Signal free region correctly selected? (y/n)</li>
<li>Water artefact fully inside red vertical lines? (y/n)</li>
</ol>
<p>You can answer questions one and two with <code>y</code> and
<code>1</code>, as the dataset is homogeneous, i.e., all spectra were
measured in the same lab with the same acquisition and processing
parameters. However, for heterogeneous datasets, it’s advisable to
optimize parameters for each batch of spectra individually.</p>
<p>Questions three and four are accompanied by two plots, shown in <a href="#fig-sim01-sfr-and-wsr">Figure 1</a>, which help you to verify the
accuracy of the selected signal-free region (SFR) and water signal
half-width (WSHW) <a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Since the used dataset was simulated based on actual
measurements in the range of approx. 3.6 to 3.3 ppm, it doesn’t contain
a water signal. Therefore, the water signal half width was set to
zero.&lt;/p&gt;"><sup>1</sup></a>. In this case, the provided parameters are
already fine, so you can answer both questions with <code>y</code>. If
adjustments are needed, you can respond with <code>n</code> and input
the correct values.</p>
<figure id="fig-sim01-sfr-and-wsr"><img src="Get_Started%5Csim_01_param_checking.svg" alt="sim_01_param_checking.svg"><figcaption><strong>Figure 1.</strong> The first spectrum of the Sim dataset. The
x-Axis gives the chemical shift of each datapoint in parts per million
(ppm). The y-Axis gives the signal intensity of each datapoint in
arbitrary units (au). The borders of the signal free region are shown as
green vertical lines in the left plot. The center of the water signal is
shown as a red vertical line in the right plot. Because the water signal
half width is set to zero, the borders of the water signal region equal
its center.
</figcaption></figure><p>When using the function in scripts, where interactive user input is
not desired, you can disable the interactive prompting by setting
parameter <code>ask</code> to <code>FALSE</code>. In this case, the
provided parameters will be used for the deconvolution of all spectra
automatically. <a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;In this case it may be useful to set
&lt;code&gt;ask = TRUE&lt;/code&gt; for the first run to determine the optimal
parameters interactively and then set &lt;code&gt;ask = FALSE&lt;/code&gt; for
subsequent runs.&lt;/p&gt;"><sup>2</sup></a></p>
</div>
<div class="section level2">
<h2 id="visualize-deconvoluted-spectra">Visualize deconvoluted spectra<a class="anchor" aria-label="anchor" href="#visualize-deconvoluted-spectra"></a>
</h2>
<p>After completing the deconvolution, it is advisable to visualize the
extracted signals using <code><a href="../reference/plot_spectrum.html">plot_spectrum()</a></code> to assess the
quality of the deconvolution:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize the first spectrum only</span></span>
<span><span class="fu">metabodecon</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_spectrum.html">plot_spectrum</a></span><span class="op">(</span><span class="va">deconvoluted_spectra</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize all spectra and save them to a pdf file</span></span>
<span><span class="va">pdfpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".pdf"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span><span class="va">pdfpath</span>, width <span class="op">=</span> <span class="fl">12</span>, height <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">deconvoluted_spectra</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">metabodecon</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_spectrum.html">plot_spectrum</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">deconvoluted_spectra</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>        main <span class="op">=</span> <span class="va">deconvoluted_spectra</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">filename</span>,</span>
<span>        foc_frac <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Plots saved to"</span>, <span class="va">pdfpath</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<p>Out of the 16 generated plots, the first two are shown as examples in
<a href="#fig-sim1-plots">Figure 2</a>. Things to look out for are:</p>
<ol style="list-style-type: decimal">
<li>That the smoothing does not remove any real signals. If the
smoothing is too strong, i.e., the smoothed signal intensity (SI) is
very different from the raw SI, you should adjust the smoothing
parameters <code>smopts</code> in the call to
<code><a href="../reference/deconvolute.html">generate_lorentz_curves()</a></code>.</li>
<li>That the superposition of the lorentz curves is a good approximation
of the smoothed SI. If major peaks are missed by the algorithm, you
should reduce the threshold <code>delta</code> in the call to
<code><a href="../reference/deconvolute.html">generate_lorentz_curves()</a></code>.</li>
</ol>
<figure id="fig-sim1-plots"><a href="Get_Started/sim_01_spectrum.svg"><img src="Get_Started%2Fsim_01_spectrum.svg" alt="sim_01_spectrum.svg" width="49%"></a>
<a href="Get_Started/sim_02_spectrum.svg"><img src="Get_Started%2Fsim_02_spectrum.svg" alt="sim_02_spectrum.svg" width="49%"></a>
<figcaption><strong>Figure 2.</strong> Deconvolution results for the first two
spectra of the Sim dataset. The raw SI (black), smoothed SI (blue), and
superposition of Lorentz curves (red) are closely aligned, indicating
that <code>smopts</code> and <code>delta</code> were chosen well and
that the deconvolution was successful.
</figcaption></figure>
</div>
<div class="section level2">
<h2 id="align-deconvoluted-spectra">Align deconvoluted spectra<a class="anchor" aria-label="anchor" href="#align-deconvoluted-spectra"></a>
</h2>
<p>The last step in the Metabodecon Workflow is to align the
deconvoluted spectra. This is necessary because the chemical shifts of
the peaks in the spectra may vary slightly due to differences in the
measurement conditions.</p>
<p>To visualize the data before and after the alignment, you can use
<code><a href="../reference/plot_spectra.html">plot_spectra()</a></code>. To do the alignment, you can use
<code><a href="../reference/align.html">align()</a></code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">metabodecon</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_spectra.html">plot_spectra</a></span><span class="op">(</span><span class="va">deconvoluted_spectra</span><span class="op">)</span></span>
<span><span class="va">aligned_spectra</span> <span class="op">&lt;-</span> <span class="fu">metabodecon</span><span class="fu">::</span><span class="fu"><a href="../reference/align.html">align</a></span><span class="op">(</span><span class="va">deconvoluted_spectra</span>, maxCombine <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">metabodecon</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_spectra.html">plot_spectra</a></span><span class="op">(</span><span class="va">aligned_spectra</span><span class="op">)</span></span></code></pre></div>
<p>The resulting plots are shown in <a href="#fig-sim-spectra-overlayed">Figure 3</a></p>
<figure id="fig-sim-spectra-overlayed"><a href="Get_Started/sim_spectra_overlayed.svg">
<img src="Get_Started%2Fsim_spectra_overlayed.svg" alt="sim_spectra_overlayed.svg"></a>
<figcaption><strong>Figure 3.</strong> Overlay of all 16 deconvoluted spectra from
the Sim dataset. The x-Axis gives the chemical shift of each datapoint
in parts per million (ppm). The y-Axis gives the signal intensity of
each datapoint in arbitrary units (au). All specta are pretty similar to
each other except for Spetrum 2, which appears to be shifted approx.
0.01 ppm to the right.
</figcaption></figure><!-- Footnotes -->
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tobias Schmidt, Martina Haeckl, Wolfram Gronwald.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
