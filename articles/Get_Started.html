<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Get Started • metabodecon</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get Started">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">metabodecon</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Get_Started.html">Get Started</a></li>
    <li><a class="dropdown-item" href="../articles/FAQ.html">FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/MetaboDecon1D.html">MetaboDecon1D</a></li>
    <li><a class="dropdown-item" href="../articles/Datasets.html">Datasets</a></li>
    <li><a class="dropdown-item" href="../articles/Contributing.html">Contributing</a></li>
    <li><a class="dropdown-item" href="../articles/Compatibility.html">Compatibility</a></li>
    <li><a class="dropdown-item" href="../articles/Classes.html">Metabodecon Classes</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/spang-lab/metabodecon/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Get Started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/spang-lab/metabodecon/blob/main/vignettes/Get_Started.Rmd" class="external-link"><code>vignettes/Get_Started.Rmd</code></a></small>
      <div class="d-none name"><code>Get_Started.Rmd</code></div>
    </div>

    
    
<style>
/*
IMPORTANT: pkgdown articles [^1] and  rmarkdown  html  vignettes  [^2]  generate
different HTML elements from the same rmarkdown content. Therefore  we  need  to
take care to handle both usecases. In particular, articles  use  `<figure>`  and
`<caption>`  elements,  where  vignettes  use  `<div  class="figure">`  and  `<p
class="caption">` elements.

[^1] built using `pkgdown::build_article()`)
[^2] built using `rmarkdown::render()`
*/

figure, div.figure
{
    border: 1px solid #dee2e6;
    border-radius: .375rem;
    padding: 0;
    margin: 1em 0;
}
caption, p.caption {
    text-align: center;
    font-style: italic;
    border-top: 1px solid #dee2e6;
    padding: 0.75rem;
    background-color: #ffffff;
}
img {
    margin: 0 auto;
    padding: 0;
    border: none;
    width: 50%;
}
@media (max-width: 500px) {
    img {
        width: 100%; /* Full width for smaller viewports */
    }
}
</style>
<p>This article shows how Metabodecon can be used for deconvoluting and
aligning one-dimensional NMR spectra using the pre-installed <a href="https://spang-lab.github.io/metabodecon/articles/Datasets.html#sim">Sim</a>
dataset as an example. The Sim dataset includes 16 simulated spectra,
each with 2048 data points ranging from ≈ 3.6 to 3.3 ppm. These
simulated spectra closely mimic the resolution and signal strength of
real NMR experiments on blood plasma from 16 individuals. The Sim
dataset is used instead of the Blood dataset because it is smaller,
faster to process, and comes pre-installed with the package. For more
information on the Sim and Blood datasets, see <a href="https://spang-lab.github.io/metabodecon/articles/Datasets.html">Datasets</a>.</p>
<div class="section level2">
<h2 id="deconvolute-spectra">Deconvolute spectra<a class="anchor" aria-label="anchor" href="#deconvolute-spectra"></a>
</h2>
<p>To find the path to the Sim dataset, you can use the
<code><a href="../reference/metabodecon_file.html">metabodecon_file()</a></code> function, which returns the path to any
file or directory within the package directory. To deconvolute the
spectra within the Sim dataset you can use
<code><a href="../reference/deconvolute.html">generate_lorentz_curves()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_dir</span> <span class="op">&lt;-</span> <span class="fu">metabodecon</span><span class="fu">::</span><span class="fu"><a href="../reference/metabodecon_file.html">metabodecon_file</a></span><span class="op">(</span><span class="st">"bruker/sim"</span><span class="op">)</span></span>
<span><span class="va">deconvoluted_spectra</span> <span class="op">&lt;-</span> <span class="fu">metabodecon</span><span class="fu">::</span><span class="fu"><a href="../reference/deconvolute.html">generate_lorentz_curves</a></span><span class="op">(</span></span>
<span>    data_path <span class="op">=</span> <span class="va">sim_dir</span>, <span class="co"># Path to directory containing spectra</span></span>
<span>    sfr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3.35</span>, <span class="fl">3.55</span><span class="op">)</span>, <span class="co"># Borders of signal free region (SFR) in ppm</span></span>
<span>    wshw <span class="op">=</span> <span class="fl">0</span>,            <span class="co"># Half width of water signal (WS) in ppm</span></span>
<span>    smopts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span>,    <span class="co"># Configure smoothing parameters</span></span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span>      <span class="co"># Suppress status messages</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After calling <code><a href="../reference/deconvolute.html">generate_lorentz_curves()</a></code>, the function
will ask you to answer the following questions to determine the optimal
deconvolution parameters:</p>
<ol style="list-style-type: decimal">
<li>Use same parameters for all spectra? (y/n)</li>
<li>Number of spectrum for adjusting parameters? (1: sim_01, 2: sim_02,
…)</li>
<li>Signal free region correctly selected? (y/n)</li>
<li>Water artefact fully inside red vertical lines? (y/n)</li>
</ol>
<p>You can answer questions one and two with <code>y</code> and
<code>1</code>, as the dataset is homogeneous, i.e., all spectra were
measured in the same lab with the same acquisition and processing
parameters. However, for heterogeneous datasets, it’s advisable to
optimize parameters for each batch of spectra individually.</p>
<p>Questions three and four are accompanied by two plots, shown in <a href="#fig-deconvolute">Figure 1</a>, which help you to verify the
accuracy of the selected signal-free region (SFR) and water signal
half-width (WSHW) <a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Since the used dataset was simulated based on actual
measurements in the range of approx. 3.6 to 3.3 ppm, it doesn’t contain
a water signal. Therefore, the water signal half width was set to
zero.&lt;/p&gt;"><sup>1</sup></a>. In this case, the provided parameters are
already fine, so you can answer both questions with <code>y</code>. If
adjustments are needed, you can respond with <code>n</code> and input
the correct values.</p>
<p><a id="fig-deconvolute"></a></p>
<div class="figure">
<img src="Get_Started_files/figure-html/fig-deconvolute-1.png" alt="&lt;strong&gt;Figure 1.&lt;/strong&gt; The first spectrum of the Sim dataset. The x-Axis gives the chemical shift of each datapoint in parts per million (ppm). The y-Axis gives the signal intensity of each datapoint in arbitrary units (au). The signal free regions are shown as green rectangles in the left plot. The water signal region, usually shown as blue rectangle, is shown in the right plot. Because the water signal half width is set to zero in this case, the rectangle collapses to a vertical line." width="480" height="auto"><img src="Get_Started_files/figure-html/fig-deconvolute-2.png" alt="&lt;strong&gt;Figure 1.&lt;/strong&gt; The first spectrum of the Sim dataset. The x-Axis gives the chemical shift of each datapoint in parts per million (ppm). The y-Axis gives the signal intensity of each datapoint in arbitrary units (au). The signal free regions are shown as green rectangles in the left plot. The water signal region, usually shown as blue rectangle, is shown in the right plot. Because the water signal half width is set to zero in this case, the rectangle collapses to a vertical line." width="480" height="auto"><p class="caption">
<strong>Figure 1.</strong> The first spectrum of the Sim dataset. The
x-Axis gives the chemical shift of each datapoint in parts per million
(ppm). The y-Axis gives the signal intensity of each datapoint in
arbitrary units (au). The signal free regions are shown as green
rectangles in the left plot. The water signal region, usually shown as
blue rectangle, is shown in the right plot. Because the water signal
half width is set to zero in this case, the rectangle collapses to a
vertical line.
</p>
</div>
<p>When using the function in scripts, where interactive user input is
not desired, you can disable the interactive prompting by setting
parameter <code>ask</code> to <code>FALSE</code>. In this case, the
provided parameters will be used for the deconvolution of all spectra
automatically. <a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;In this case it may be useful to set
&lt;code&gt;ask = TRUE&lt;/code&gt; for the first run to determine the optimal
parameters interactively and then set &lt;code&gt;ask = FALSE&lt;/code&gt; for
subsequent runs.&lt;/p&gt;"><sup>2</sup></a></p>
</div>
<div class="section level2">
<h2 id="visualize-deconvoluted-spectra">Visualize deconvoluted spectra<a class="anchor" aria-label="anchor" href="#visualize-deconvoluted-spectra"></a>
</h2>
<p>After completing the deconvolution, it is advisable to visualize the
extracted signals using <code><a href="../reference/plot_spectrum.html">plot_spectrum()</a></code> to assess the
quality of the deconvolution.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize the first spectrum.</span></span>
<span><span class="fu">metabodecon</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_spectrum.html">plot_spectrum</a></span><span class="op">(</span><span class="va">deconvoluted_spectra</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize the second spectrum, this time without the legend.</span></span>
<span><span class="fu">metabodecon</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_spectrum.html">plot_spectrum</a></span><span class="op">(</span><span class="va">deconvoluted_spectra</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, lgd <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize all spectra and save them to a pdf file</span></span>
<span><span class="va">pdfpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".pdf"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span><span class="va">pdfpath</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">x</span> <span class="kw">in</span> <span class="va">deconvoluted_spectra</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">metabodecon</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_spectrum.html">plot_spectrum</a></span><span class="op">(</span><span class="va">x</span>, main <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">filename</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Plots saved to"</span>, <span class="va">pdfpath</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<p>Out of the 16 generated plots, the first two are shown as examples in
<a href="#fig-plot-spectrum">Figure 2</a>. Things to look out for
are:</p>
<ol style="list-style-type: decimal">
<li>That the smoothing does not remove any real signals. If the
smoothing is too strong, i.e., the smoothed signal intensity (SI) is
very different from the raw SI, you should adjust the smoothing
parameters <code>smopts</code> in the call to
<code><a href="../reference/deconvolute.html">generate_lorentz_curves()</a></code>.</li>
<li>That the superposition of the lorentz curves is a good approximation
of the smoothed SI. If major peaks are missed by the algorithm, you
should reduce the threshold <code>delta</code> in the call to
<code><a href="../reference/deconvolute.html">generate_lorentz_curves()</a></code>.</li>
</ol>
<p><a id="fig-plot-spectrum"></a></p>
<div class="figure">
<img src="Get_Started_files/figure-html/fig-plot-spectrum-1.png" alt="&lt;strong&gt;Figure 2.&lt;/strong&gt; Deconvolution results for the first two spectra of the Sim dataset. The raw SI (black), smoothed SI (blue), and superposition of Lorentz curves (red) are closely aligned, indicating that &lt;code&gt;smopts&lt;/code&gt; and &lt;code&gt;delta&lt;/code&gt; were chosen well and that the deconvolution was successful." width="480" height="auto"><img src="Get_Started_files/figure-html/fig-plot-spectrum-2.png" alt="&lt;strong&gt;Figure 2.&lt;/strong&gt; Deconvolution results for the first two spectra of the Sim dataset. The raw SI (black), smoothed SI (blue), and superposition of Lorentz curves (red) are closely aligned, indicating that &lt;code&gt;smopts&lt;/code&gt; and &lt;code&gt;delta&lt;/code&gt; were chosen well and that the deconvolution was successful." width="480" height="auto"><p class="caption">
<strong>Figure 2.</strong> Deconvolution results for the first two
spectra of the Sim dataset. The raw SI (black), smoothed SI (blue), and
superposition of Lorentz curves (red) are closely aligned, indicating
that <code>smopts</code> and <code>delta</code> were chosen well and
that the deconvolution was successful.
</p>
</div>
</div>
<div class="section level2">
<h2 id="align-deconvoluted-spectra">Align deconvoluted spectra<a class="anchor" aria-label="anchor" href="#align-deconvoluted-spectra"></a>
</h2>
<p>The last step in the Metabodecon Workflow is to align the
deconvoluted spectra. This is necessary because the chemical shifts of
the peaks in the spectra may vary slightly due to differences in the
measurement conditions.</p>
<p>To perform the alignment, you can use <code><a href="../reference/align.html">align()</a></code>. To
visualize the data before and after the alignment, you can use
<code><a href="../reference/plot_spectra.html">plot_spectra()</a></code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot spectra before alignment. Only shows spectra 1-8 for clarity.</span></span>
<span><span class="fu">metabodecon</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_spectra.html">plot_spectra</a></span><span class="op">(</span><span class="va">deconvoluted_spectra</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>, lgd <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Align spectra and plot again.</span></span>
<span><span class="va">aligned_spectra</span> <span class="op">&lt;-</span> <span class="fu">metabodecon</span><span class="fu">::</span><span class="fu"><a href="../reference/align.html">align</a></span><span class="op">(</span><span class="va">deconvoluted_spectra</span><span class="op">)</span></span>
<span><span class="fu">metabodecon</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_spectra.html">plot_spectra</a></span><span class="op">(</span><span class="va">aligned_spectra</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The resulting plots are shown in <a href="#fig-align">Figure 3</a>.
Before the alignment, the spectra exhibit generally similar shapes but
do not perfectly overlap. After the alignment, the spectra are much more
consistent with each other, indicating that the alignment was
successful. Notably, spectrum two has been shifted significantly to the
left.</p>
<a id="fig-align"></a>
<div class="figure">
<img src="Get_Started_files/figure-html/fig-align-1.png" alt="&lt;strong&gt;Figure 3.&lt;/strong&gt; Overlay of the first eight deconvoluted spectra from the Sim dataset before alignment (left) and after alignment (right). The x-Axis gives the chemical shift of each datapoint in parts per million (ppm). The y-Axis gives the signal intensity of each datapoint in arbitrary units (au). All specta are pretty similar to each other except for Spectrum 2, which got shifted approx. 0.01 ppm to the right." width="480" height="auto"><img src="Get_Started_files/figure-html/fig-align-2.png" alt="&lt;strong&gt;Figure 3.&lt;/strong&gt; Overlay of the first eight deconvoluted spectra from the Sim dataset before alignment (left) and after alignment (right). The x-Axis gives the chemical shift of each datapoint in parts per million (ppm). The y-Axis gives the signal intensity of each datapoint in arbitrary units (au). All specta are pretty similar to each other except for Spectrum 2, which got shifted approx. 0.01 ppm to the right." width="480" height="auto"><p class="caption">
<strong>Figure 3.</strong> Overlay of the first eight deconvoluted
spectra from the Sim dataset before alignment (left) and after alignment
(right). The x-Axis gives the chemical shift of each datapoint in parts
per million (ppm). The y-Axis gives the signal intensity of each
datapoint in arbitrary units (au). All specta are pretty similar to each
other except for Spectrum 2, which got shifted approx. 0.01 ppm to the
right.
</p>
</div>
<!-- Footnotes -->
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tobias Schmidt, Martina Haeckl, Wolfram Gronwald.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
