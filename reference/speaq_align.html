<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Align Signals using 'speaq' — speaq_align • metabodecon</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Align Signals using 'speaq' — speaq_align"><meta name="description" content="Performs signal alignment across the individual spectra using the 'speaq'
package (Beirnaert C, Meysman P, Vu TN, Hermans N, Apers S, Pieters L, et al.
(2018) speaq 2.0: A complete workflow for high-throughput 1D NMRspectra
processing and quantification. PLoS Comput Biol 14(3): e1006018.
https://www.doi.org/10.1371/journal.pcbi.1006018). The spectra deconvolution
process yields the signals of all spectra. Due to slight changes in
measurement conditions, e.g. pH variations, signal positions may vary
slightly across spectra. As a consequence, prior to further analysis signals
belonging to the same compound have to be aligned across spectra. This is the
purpose of the 'speaq' package."><meta property="og:description" content="Performs signal alignment across the individual spectra using the 'speaq'
package (Beirnaert C, Meysman P, Vu TN, Hermans N, Apers S, Pieters L, et al.
(2018) speaq 2.0: A complete workflow for high-throughput 1D NMRspectra
processing and quantification. PLoS Comput Biol 14(3): e1006018.
https://www.doi.org/10.1371/journal.pcbi.1006018). The spectra deconvolution
process yields the signals of all spectra. Due to slight changes in
measurement conditions, e.g. pH variations, signal positions may vary
slightly across spectra. As a consequence, prior to further analysis signals
belonging to the same compound have to be aligned across spectra. This is the
purpose of the 'speaq' package."><meta property="og:image" content="https://spang-lab.github.io/metabodecon/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">metabodecon</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Get_Started.html">Get Started</a></li>
    <li><a class="dropdown-item" href="../articles/FAQ.html">FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/MetaboDecon1D.html">MetaboDecon1D</a></li>
    <li><a class="dropdown-item" href="../articles/Datasets.html">Datasets</a></li>
    <li><a class="dropdown-item" href="../articles/Contributing.html">Contributing</a></li>
    <li><a class="dropdown-item" href="../articles/Compatibility.html">Compatibility</a></li>
    <li><a class="dropdown-item" href="../articles/Classes.html">Metabodecon Classes</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/spang-lab/metabodecon/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Align Signals using 'speaq'</h1>
      <small class="dont-index">Source: <a href="https://github.com/spang-lab/metabodecon/blob/v1.4.2/R/align.R" class="external-link"><code>R/align.R</code></a></small>
      <div class="d-none name"><code>speaq_align.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs signal alignment across the individual spectra using the 'speaq'
package (Beirnaert C, Meysman P, Vu TN, Hermans N, Apers S, Pieters L, et al.
(2018) speaq 2.0: A complete workflow for high-throughput 1D NMRspectra
processing and quantification. PLoS Comput Biol 14(3): e1006018.
https://www.doi.org/10.1371/journal.pcbi.1006018). The spectra deconvolution
process yields the signals of all spectra. Due to slight changes in
measurement conditions, e.g. pH variations, signal positions may vary
slightly across spectra. As a consequence, prior to further analysis signals
belonging to the same compound have to be aligned across spectra. This is the
purpose of the 'speaq' package.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">speaq_align</span><span class="op">(</span></span>
<span>  feat <span class="op">=</span> <span class="fu"><a href="gen_feat_mat.html">gen_feat_mat</a></span><span class="op">(</span><span class="va">spectrum_data</span><span class="op">)</span>,</span>
<span>  maxShift <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  <span class="va">spectrum_data</span>,</span>
<span>  si_size_real_spectrum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">spectrum_data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">y_values</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  show <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-feat">feat<a class="anchor" aria-label="anchor" href="#arg-feat"></a></dt>
<dd><p>Output of <code><a href="gen_feat_mat.html">gen_feat_mat()</a></code>.</p></dd>


<dt id="arg-maxshift">maxShift<a class="anchor" aria-label="anchor" href="#arg-maxshift"></a></dt>
<dd><p>Maximum number of points along the "ppm-axis" which a value
can be moved by speaq package e.g. 50. 50 is a suitable starting value for
plasma spectra with a digital resolution of 128K. Note that this parameter
has to be individually optimized depending on the type of analyzed spectra
and the digital resolution. For urine which is more prone to chemical shift
variations this value most probably has to be increased.</p></dd>


<dt id="arg-spectrum-data">spectrum_data<a class="anchor" aria-label="anchor" href="#arg-spectrum-data"></a></dt>
<dd><p>Output of <code><a href="deconvolute.html">generate_lorentz_curves()</a></code>.</p></dd>


<dt id="arg-si-size-real-spectrum">si_size_real_spectrum<a class="anchor" aria-label="anchor" href="#arg-si-size-real-spectrum"></a></dt>
<dd><p>Number of real data points in your original
spectra.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Whether to print additional information during the alignment
process.</p></dd>


<dt id="arg-show">show<a class="anchor" aria-label="anchor" href="#arg-show"></a></dt>
<dd><p>Whether to plot the original and aligned spectra.</p></dd>


<dt id="arg-mfrow">mfrow<a class="anchor" aria-label="anchor" href="#arg-mfrow"></a></dt>
<dd><p>Layout to use for the plot. Passed on to <code><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par()</a></code>. Use <code>mfrow = NULL</code> if the plot layout should not be changed.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A matrix containing the integral values of the spectra after alignment.</p>
<p>There is one row per spectrum and one column per ppm value. The entry at
position <code>i, j</code> holds the integral value of the signal from spectrum <code>i</code> that
has its center at position <code>j</code> after alignment by speaq. If there is no
signal with center <code>j</code> in spectrum <code>i</code>, entry <code>i, j</code> is set to NA. The column
names of the matrix are the ppm values of the original spectra.</p>
<p>Example return matrix:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>    ...  <span class="fl">3.59</span>  <span class="fl">3.55</span>  <span class="fl">3.57</span>  <span class="fl">3.56</span>  <span class="fl">3.55</span>  <span class="fl">3.54</span>  <span class="fl">3.53</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  .<span class="sc">---------------------------------------------</span><span class="ot">-&gt;</span> PPM</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="dv">1</span> <span class="sc">|</span> <span class="cn">NA</span>   <span class="cn">NA</span>    <span class="fl">0.20</span>  <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="fl">0.25</span>  <span class="cn">NA</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="dv">2</span> <span class="sc">|</span> <span class="cn">NA</span>   <span class="cn">NA</span>    <span class="fl">0.15</span>  <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="fl">0.13</span>  <span class="cn">NA</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="dv">3</span> <span class="sc">|</span> <span class="cn">NA</span>   <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="fl">0.2</span>   <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="fl">0.18</span>  <span class="cn">NA</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>SpNr</span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Initial version from Wolfram Gronwald.
Refactored by Tobias Schmidt in 2024.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">sim_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="metabodecon_file.html">metabodecon_file</a></span><span class="op">(</span><span class="st">"bruker/sim_subset"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">spectrum_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="deconvolute.html">generate_lorentz_curves_sim</a></span><span class="op">(</span><span class="va">sim_subset</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">feat</span> <span class="op">&lt;-</span> <span class="fu"><a href="gen_feat_mat.html">gen_feat_mat</a></span><span class="op">(</span><span class="va">spectrum_data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">maxShift</span> <span class="op">&lt;-</span> <span class="fl">200</span></span></span>
<span class="r-in"><span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu">speaq_align</span><span class="op">(</span><span class="va">feat</span>, <span class="va">maxShift</span>, <span class="va">spectrum_data</span>, show <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  --------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  dohCluster will run with maxShift= 200</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  If you want dohCluster to detect the optimal maxShift automatically,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  use dohCluster(..., maxShift = NULL, ...)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  --------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  aligning spectrum  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Median pearson correlation of aligned spectra: 0.9977223</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Alignment time:  2e-04  minutes</span>
<span class="r-plt img"><img src="speaq_align-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  num [1:2, 1:2048] NA NA NA NA NA NA NA NA NA NA ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - attr(*, "dimnames")=List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ : NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ : chr [1:2048] "3.59" "3.58985" "3.5897" "3.58955" ...</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tobias Schmidt, Martina Haeckl, Wolfram Gronwald.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

