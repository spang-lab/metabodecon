<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Evaluate an expression with predefined global state — evalwith • metabodecon</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Evaluate an expression with predefined global state — evalwith"><meta name="description" content="Evaluates an expression with a predefined global state, including the:
working directory (set via setwd())
global options (set via options())
graphical parameters (set via par())


In addition to that, evalwith allows to:
Redirect or capture the output and/or message stream via sink()
Measure the runtime of the evaluated expression via system.time()
Creating a temporary test directory (inside tmpdir()) and populating it
with input files according to inputs
Predefine answers for calls to readline() happening during evaluation of
expr
Caching the result of the expression


All changes to the global state are reverted after the expression has been
evaluated."><meta property="og:description" content="Evaluates an expression with a predefined global state, including the:
working directory (set via setwd())
global options (set via options())
graphical parameters (set via par())


In addition to that, evalwith allows to:
Redirect or capture the output and/or message stream via sink()
Measure the runtime of the evaluated expression via system.time()
Creating a temporary test directory (inside tmpdir()) and populating it
with input files according to inputs
Predefine answers for calls to readline() happening during evaluation of
expr
Caching the result of the expression


All changes to the global state are reverted after the expression has been
evaluated."><meta property="og:image" content="https://spang-lab.github.io/metabodecon/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">metabodecon</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Get_Started.html">Get Started</a></li>
    <li><a class="dropdown-item" href="../articles/FAQ.html">FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/MetaboDecon1D.html">MetaboDecon1D</a></li>
    <li><a class="dropdown-item" href="../articles/Datasets.html">Datasets</a></li>
    <li><a class="dropdown-item" href="../articles/Contributing.html">Contributing</a></li>
    <li><a class="dropdown-item" href="../articles/Compatibility.html">Compatibility</a></li>
    <li><a class="dropdown-item" href="../articles/Classes.html">Metabodecon Classes</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/spang-lab/metabodecon/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Evaluate an expression with predefined global state</h1>
      <small class="dont-index">Source: <a href="https://github.com/spang-lab/metabodecon/blob/main/R/90_testing.R" class="external-link"><code>R/90_testing.R</code></a></small>
      <div class="d-none name"><code>evalwith.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Evaluates an expression with a predefined global state, including the:</p><ul><li><p>working directory (set via <code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd()</a></code>)</p></li>
<li><p>global options (set via <code><a href="https://rdrr.io/r/base/options.html" class="external-link">options()</a></code>)</p></li>
<li><p>graphical parameters (set via <code><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par()</a></code>)</p></li>
</ul><p>In addition to that, <code>evalwith</code> allows to:</p><ul><li><p>Redirect or capture the output and/or message stream via <code><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink()</a></code></p></li>
<li><p>Measure the runtime of the evaluated expression via <code><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time()</a></code></p></li>
<li><p>Creating a temporary test directory (inside <code><a href="tmpdir.html">tmpdir()</a></code>) and populating it
with input files according to <code>inputs</code></p></li>
<li><p>Predefine answers for calls to <code><a href="https://rdrr.io/r/base/readline.html" class="external-link">readline()</a></code> happening during evaluation of
<code>expr</code></p></li>
<li><p>Caching the result of the expression</p></li>
</ul><p>All changes to the global state are reverted after the expression has been
evaluated.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">evalwith</span><span class="op">(</span></span>
<span>  <span class="va">expr</span>,</span>
<span>  testdir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  answers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  output <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  message <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  datadir_temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"default"</span>, <span class="st">"missing"</span>, <span class="st">"empty"</span>, <span class="st">"filled"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  datadir_persistent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"default"</span>, <span class="st">"missing"</span>, <span class="st">"empty"</span>, <span class="st">"filled"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  opts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cache <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-expr">expr<a class="anchor" aria-label="anchor" href="#arg-expr"></a></dt>
<dd><p>Expression to be evaluated.</p></dd>


<dt id="arg-testdir">testdir<a class="anchor" aria-label="anchor" href="#arg-testdir"></a></dt>
<dd><p>ID of the test directory. E.g. <code>"xyz/2"</code>. Will be created and
populated with <code>inputs</code>. To clear, use <code>clear(testdir("xyz/2"))</code>.</p></dd>


<dt id="arg-answers">answers<a class="anchor" aria-label="anchor" href="#arg-answers"></a></dt>
<dd><p>Answers to be returned by readline().</p></dd>


<dt id="arg-output">output<a class="anchor" aria-label="anchor" href="#arg-output"></a></dt>
<dd><p>Path to the file where output stream should be redirected to.
Use <code>"captured"</code> to capture the output.</p></dd>


<dt id="arg-message">message<a class="anchor" aria-label="anchor" href="#arg-message"></a></dt>
<dd><p>Path to the file where message stream be redirected to. Use
<code>"captured"</code> to capture the messages.</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p>An expression opening a device, the string "captured" or a path
ending in ".pdf", ".svg", or ".png". Examples: <code>svg("tmp.svg")</code>,
<code>quote(pdf("tmp.pdf"))</code>, <code>"captured"</code>, <code>"tmp.png"</code>. Passing <code>"captured"</code> is
equivalent to passing <code>tempfile(fileext = ".png")</code>.</p></dd>


<dt id="arg-datadir-temp">datadir_temp<a class="anchor" aria-label="anchor" href="#arg-datadir-temp"></a></dt>
<dd><p>State of the mocked temporary data directory. See details
section.</p></dd>


<dt id="arg-datadir-persistent">datadir_persistent<a class="anchor" aria-label="anchor" href="#arg-datadir-persistent"></a></dt>
<dd><p>State of the mocked persistent data directory. See
details section.</p></dd>


<dt id="arg-inputs">inputs<a class="anchor" aria-label="anchor" href="#arg-inputs"></a></dt>
<dd><p>Paths to be copied to the test directory before evaluating
<code>expr</code>.</p></dd>


<dt id="arg-opts">opts<a class="anchor" aria-label="anchor" href="#arg-opts"></a></dt>
<dd><p>Named list of options to be set. See <code><a href="https://rdrr.io/r/base/options.html" class="external-link">options()</a></code>.</p></dd>


<dt id="arg-pars">pars<a class="anchor" aria-label="anchor" href="#arg-pars"></a></dt>
<dd><p>Named list of parameters to be set. See <code><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par()</a></code>.</p></dd>


<dt id="arg-cache">cache<a class="anchor" aria-label="anchor" href="#arg-cache"></a></dt>
<dd><p>Logical indicating whether to cache the result of the
expression.</p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>Logical indicating whether to overwrite the cache file if it
already exists.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing with following elements:</p><ul><li><p><code>rv</code>: The return value of the expression.</p></li>
<li><p><code>runtime</code>: The "elapsed" runtime of the expression in seconds. Measured
with <code><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time()</a></code>.</p></li>
<li><p><code>output</code>: The captured output.</p></li>
<li><p><code>message</code>: The captured messages.</p></li>
<li><p><code>plot</code>: The path to the saved plot.</p></li>
<li><p><code>testdir</code>: The path to the test directory.</p></li>
<li><p><code>inputs</code>: The paths to the copied input files.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>datadir_temp</code> and <code>datadir_persistent</code> arguments accept values
"missing", "filled" and "empty". Setting a value unequal NULL causes the
functions <code><a href="datadir_temp.html">datadir_temp()</a></code> and/or <code><a href="datadir_persistent.html">datadir_persistent()</a></code> to be replaced with
mock functions pointing to fake directories. Functions depending on these
functions will then use the fake directories instead of the real ones. When
set to "missing" the returned mock directory does not exist. When set to
"empty" it exists and is guaranteed to be empty. When set to "filled", it is
populated with example datasets.</p>
<p>Attention: the mocked functions, i.e. <code><a href="datadir_temp.html">datadir_temp()</a></code> and
<code><a href="datadir_persistent.html">datadir_persistent()</a></code> cannot be used directly inside <code>expr</code> when called via
<code><a href="https://devtools.r-lib.org/reference/test.html" class="external-link">devtools::test()</a></code>. I'm not sure why, but it seems as if devtools and/or
testthat have their own copies of the functions which are used when the
expression is evaluated.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu">evalwith</span><span class="op">(</span>output <span class="op">=</span> <span class="st">"captured"</span>, <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Helloworld\n"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ rv     : NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ runtime: num 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ output : chr "Helloworld"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ message: chr(0) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ plot   : NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ testdir: NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ inputs : chr(0) </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu">evalwith</span><span class="op">(</span>datadir_persistent <span class="op">=</span> <span class="st">"missing"</span>, message <span class="op">=</span> <span class="st">"captured"</span>, <span class="fu"><a href="datadir.html">datadir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Warning: /tmp/RtmpFKmhOe/metabodecon/data does not exist. Please call `download_example_datasets()` first.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ rv     : chr "/tmp/RtmpFKmhOe/metabodecon/data"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ runtime: num 0.001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ output : chr(0) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ message: chr(0) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ plot   : NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ testdir: NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ inputs : chr(0) </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="fu">evalwith</span><span class="op">(</span>testdir <span class="op">=</span> <span class="st">"dummy"</span>, inputs <span class="op">=</span> <span class="st">"bruker/urine/urine_1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">x3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ rv     : chr "urine_1"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ runtime: num 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ output : chr(0) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ message: chr(0) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ plot   : NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ testdir: chr "dummy"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ inputs : chr "bruker/urine/urine_1"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x4</span> <span class="op">&lt;-</span> <span class="fu">evalwith</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.02</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">x4</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ rv     : NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ runtime: num 0.02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ output : chr(0) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ message: chr(0) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ plot   : NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ testdir: NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ inputs : chr(0) </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tobias Schmidt, Martina Haeckl, Wolfram Gronwald.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

